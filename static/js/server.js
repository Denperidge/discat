function showAvailableModules() {
    openMenu();
    menuRequest.open("GET", "/allmodules", true);
    menuRequest.send();
}

function saveServerSettings() {
    var saveServerSettingsRequest = new XMLHttpRequest();
    saveServerSettingsRequest.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200)
            location.reload();
    }
    saveServerSettingsRequest.open("PATCH", "/saveserversettings", true);
    saveServerSettingsRequest.setRequestHeader("Content-Type", "application/json");
    saveServerSettingsRequest.send(JSON.stringify({
        "Discord_Server_Id": document.body.id,
        "Discat_Prefix": document.getElementById("prefix").value
    }));
}

function addModule(moduleName) {
    var addModuleRequest = new XMLHttpRequest();
    addModuleRequest.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200)
            location.reload();
    }
    addModuleRequest.open("POST", "/addmodule", true);
    addModuleRequest.setRequestHeader("Content-Type", "application/json");
    addModuleRequest.send(JSON.stringify({
        "Discord_Server_Id": document.body.id,
        "Discat_Module_Name": moduleName
    }));
}

function removeModule(moduleName) {
    var removeModuleRequest = new XMLHttpRequest();
    removeModuleRequest.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200)
            location.reload();
    }
    removeModuleRequest.open("DELETE", "/removemodule", true);
    removeModuleRequest.setRequestHeader("Content-Type", "application/json");
    removeModuleRequest.send(JSON.stringify({
        "Discord_Server_Id": document.body.id,
        "Discat_Module_Name": moduleName
    }));
}

var moduleName;  // Name of module that is currently being edited, if any
function openModuleSettings(pModuleName) {
    moduleName = pModuleName;
    openMenu();
    menuRequest.open("GET", "/moduleserversettings?serverId=" + document.body.id + "&" + "modulename=" + moduleName, true);
    menuRequest.send();
}

function saveAutoGeneratedModuleSettings() {
    var body = {
        "Discord_Server_Id": document.body.id,
        "Discat_Module_Name": moduleName,
        "Discat_Module_New_Settings": {}
    };

    var settings = document.getElementById("menu").getElementsByTagName("input");
    for (var i = 0; i < settings.length; i++) {
        var setting = settings[i];
        if (setting.type == "text") body.Discat_Module_New_Settings[setting.id] = setting.value;
        else if (setting.type == "number") {
            var number = parseFloat(setting.value);
            if (!isNaN(number)) body.Discat_Module_New_Settings[setting.id] = number;
            else return;
        } else if (setting.type == "checkbox") body.Discat_Module_New_Settings[setting.id] = setting.checked;
    }

    var saveModuleSettingsRequest = new XMLHttpRequest();
    saveModuleSettingsRequest.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200)
            location.reload();
    }
    saveModuleSettingsRequest.open("PATCH", "/moduleserversettings", true);
    saveModuleSettingsRequest.setRequestHeader("Content-Type", "application/json");
    saveModuleSettingsRequest.send(JSON.stringify(body));
}